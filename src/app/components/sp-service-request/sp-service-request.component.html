<div class="container-fluid py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h4
      class="fw-bold mb-0 bg-white shadow-sm p-3 rounded-3 w-100 text-primary"
    >
      Service Management
    </h4>
  </div>

  <div class="bg-white shadow-lg p-3 rounded-3">
    <ul class="nav nav-tabs">
      <li class="nav-item">
        <button
          class="nav-link active"
          data-bs-toggle="tab"
          data-bs-target="#serviceTab"
        >
          <mat-icon>assignment</mat-icon>
          General
        </button>
      </li>
      <li class="nav-item">
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#costTab">
          <mat-icon>monetization_on</mat-icon>
          Car Stand 
        </button>
      </li>
    </ul>

    <div class="tab-content">
      <div class="tab-pane fade show active" id="serviceTab">
        <div class="card shadow-sm mb-4">
          <div class="card-header bg-light fw-semibold">
            Filter Service Requests
          </div>

          <div class="card-body">
            <form [formGroup]="serviceRequestForm">
              <div class="row g-3">
                <div class="col-md-3">
                  <label class="form-label">Service Category</label>
                  <input
                    class="form-control"
                    formControlName="serviceCategory"
                    readonly
                  />
                </div>

                <div class="col-md-3">
                  <label class="form-label">Service Sub Category</label>
                  <select class="form-select" formControlName="serviceCategory">
                    <option value="" disabled>Select Service</option>
                    <option *ngFor="let c of subCategories" [value]="c">
                      {{ c }}
                    </option>
                  </select>
                </div>

                <div class="col-md-3">
                  <label class="form-label">Service Brand</label>
                  <select class="form-select" formControlName="serviceCategory">
                    <option value="" disabled>Select Brand</option>
                    <option *ngFor="let c of subCategories" [value]="c">
                      {{ c }}
                    </option>
                  </select>
                </div>

                <div class="col-md-3">
                  <label class="form-label">Location</label>
                  <input
                    class="form-control"
                    formControlName="location"
                    ngx-gp-autocomplete
                    [options]="options"
                    (onAddressChange)="handleAddressChange($event)"
                  />
                </div>

                <div class="col-md-3">
                  <label class="form-label">Email</label>
                  <input class="form-control" formControlName="email" />
                </div>

                <div class="col-md-3">
                  <label class="form-label">Asset ID</label>
                  <select class="form-select" formControlName="assetId">
                    <option value="" disabled>Select Asset</option>
                    <option *ngFor="let a of assetIds" [value]="a">
                      {{ a }}
                    </option>
                  </select>
                </div>

                <div class="col-md-3">
                  <label class="form-label">From Date</label>
                  <input
                    type="date"
                    class="form-control"
                    formControlName="fromDate"
                  />
                </div>

                <div class="col-md-3">
                  <label class="form-label">To Date</label>
                  <input
                    type="date"
                    class="form-control"
                    formControlName="toDate"
                  />
                </div>

                <div class="col-md-3">
                  <label class="form-label">Status</label>
                  <select class="form-select" formControlName="status">
                    <option value="NEW">NEW</option>
                    <option value="approved">Approved</option>
                    <option value="rejected">Rejected</option>
                  </select>
                </div>

                <div class="col-md-3">
                  <label class="form-label">Phone Number</label>
                  <input class="form-control" formControlName="phoneNo" />
                </div>
              </div>

              <div class="text-center">
                <button
                  type="button"
                  class="btn btn-primary px-4"
                  (click)="search()"
                >
                  Search
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- Table -->
        <div class="card shadow-sm">
          <div
            class="card-header bg-light fw-semibold d-flex justify-content-between"
          >
            <span>Service Request Details</span>
            <span class="badge bg-secondary"
              >{{ tableData.length }} Records</span
            >
          </div>

          <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
              <thead class="table-light">
                <tr>
                  <th>Request ID</th>
                  <th>Asset ID</th>
                  <th>Service</th>
                  <th>Service Date</th>
                  <th>Request Date</th>
                  <th>Location</th>
                  <th>Description</th>
                  <th>Status</th>
                </tr>
              </thead>

              <tbody>
                <tr
                  *ngFor="
                    let item of tableData
                      | paginate
                        : { itemsPerPage: itemsPerPage, currentPage: page }
                  "
                >
                  <td class="fw-semibold">{{ item.requestId }}</td>
                  <td>{{ item.assetId }}</td>
                  <td>{{ item.serviceName }}</td>
                  <td>{{ item.serviceDateDb | date : "dd/MM/yyyy" }}</td>
                  <td>{{ item.serviceRequestDate | date : "dd/MM/yyyy" }}</td>
                  <td>{{ item.location }}</td>
                  <td class="text-muted">{{ item.description }}</td>
                  <td>
                    <span class="badge bg-info">{{ item.status }}</span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <div
            class="card-footer d-flex justify-content-between align-items-center"
          >
            <pagination-controls
              (pageChange)="page = $event"
            ></pagination-controls>
            <span class="text-muted"
              >Showing {{ tableData.length }} records</span
            >
          </div>
        </div>
      </div>

      <!-- COST SERVICE TAB -->
      <div class="tab-pane fade" id="costTab">
        <div class="card shadow-sm">
          <div class="card-body text-center text-muted p-0">
            <div class="container-fluid mt-2">
              <div class="card shadow-sm border-0 mb-3">
                <div class="card-header bg-info text-white fw-semibold">
                  Filters
                </div>

                <div class="card-body">
                  <div class="row g-3 align-items-end">
                    <div class="col-12 col-sm-6 col-md-3 col-lg-3">
                      <label class="form-label">From Date</label>
                      <input
                        type="date"
                        class="form-control"
                        [(ngModel)]="filter.fromRequestDate"
                      />
                    </div>

                    <div class="col-12 col-sm-6 col-md-3 col-lg-3">
                      <label class="form-label">To Date</label>
                      <input
                        type="date"
                        class="form-control"
                        [(ngModel)]="filter.toRequestDate"
                      />
                    </div>

                    <div class="col-12 col-sm-6 col-md-3 col-lg-3">
                      <label class="form-label">Request Id</label>
                      <input
                        type="text"
                        class="form-control"
                        [(ngModel)]="filter.requestId"
                      />
                    </div>

                    <div class="col-12 col-sm-6 col-md-3 col-lg-3">
                      <label class="form-label">Contact No</label>
                      <input
                        type="text"
                        class="form-control"
                        [(ngModel)]="filter.contactNumber"
                      />
                    </div>

                    <div class="col-12 col-sm-6 col-md-3 col-lg-3">
                      <label class="form-label">Vehicle Id</label>
                      <input
                        type="text"
                        class="form-control"
                        [(ngModel)]="filter.vehicleId"
                      />
                    </div>

                    <div class="col-12 col-sm-6 col-md-3 col-lg-3">
                      <label class="form-label">Service Id</label>
                      <input
                        type="text"
                        class="form-control"
                        [(ngModel)]="filter.serviceId"
                      />
                    </div>

                    <div class="col-12 col-sm-6 col-md-3 col-lg-3">
                      <label class="form-label">Brand</label>
                      <select class="form-select" [(ngModel)]="filter.brand">
                        <option value="Honda1">Honda1</option>
                        <option
                          *ngFor="let b of uniqueValues('brand')"
                          [value]="b"
                        >
                          {{ b }}
                        </option>
                      </select>
                    </div>

                    <div class="col-12 col-sm-6 col-md-3 col-lg-3">
                      <label class="form-label">Model</label>
                      <input
                        type="text"
                        class="form-control"
                        [(ngModel)]="filter.model"
                      />
                    </div>

                    <div class="col-12 col-sm-6 col-md-3 col-lg-3">
                      <label class="form-label">Status</label>
                      <input
                        type="text"
                        class="form-control"
                        [(ngModel)]="filter.status"
                      />
                    </div>

                    <div class="col-12 col-md-3 col-lg-2 d-grid ms-auto">
                      <button
                        class="btn btn-info text-white"
                        (click)="submitSearch()"
                      >
                        <i class="fa-solid fa-magnifying-glass me-1"></i> Search
                      </button>
                    </div>

                    <div class="col-12 col-md-3 col-lg-2 d-grid">
                      <button
                        class="btn btn-outline-secondary"
                        (click)="resetFilters()"
                      >
                        Reset
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <div
                *ngIf="isSearched && filteredRecordsList.length === 0"
                class="alert alert-warning text-center shadow-sm rounded-3 py-3"
              >
                <i class="fa-solid fa-circle-info me-2"></i>
                No records found
              </div>

              <div
                *ngIf="isSearched && filteredRecordsList.length > 0"
                class="card shadow-sm border-0"
              >
                <div class="card shadow-sm border-0">
                  <div
                    class="card-header bg-light fw-semibold d-flex justify-content-between align-items-center"
                  >
                    <span>
                      <i class="fa-solid fa-table me-2 text-primary"></i>
                      Service Request Details
                    </span>
                    <span class="badge bg-secondary">
                      {{ filteredRecordsList.length }} Records
                    </span>
                  </div>

                  <div class="table-responsive">
                    <table
                      class="table table-hover table-bordered align-middle mb-0"
                    >
                      <thead class="table-light sticky-top">
                        <tr>
                          <th style="width: 50px">#</th>
                          <th>Service Line ID</th>
                          <th style="width: 110px">Service ID</th>
                          <th style="width: 100px">Charge</th>
                          <th style="width: 90px">GST (%)</th>
                          <th style="width: 110px">Discount (%)</th>
                          <th>Updated By</th>
                          <th style="width: 130px">Updated Date</th>
                          <th style="width: 80px" class="text-center">
                            Actions
                          </th>
                        </tr>
                      </thead>

                      <tbody>
                        <tr
                          *ngFor="let rec of filteredRecordsList; let i = index"
                        >
                          <td class="text-center">{{ i + 1 }}</td>

                          <td class="text-break">
                            {{ rec.serviceLineId }}
                          </td>

                          <td>
                            <span class="badge bg-info text-dark">
                              {{ rec.serviceId }}
                            </span>
                          </td>

                          <td class="text-nowrap">â‚¹ {{ rec.serviceCharge }}</td>

                          <td class="text-center">
                            {{ rec.gst }}
                          </td>

                          <td class="text-center">
                            {{ rec.discount }}
                          </td>

                          <td class="text-muted small text-break">
                            {{ rec.updatedBy }}
                          </td>

                          <td class="text-nowrap">
                            {{ rec.updatedDate | date : "dd-MMM-yyyy" }}
                          </td>

                          <td class="text-center">
                            <button
                              class="btn btn-sm btn-outline-danger rounded-circle"
                              (click)="deleteRecord(i)"
                              title="Delete"
                            >
                              <i class="fa-solid fa-trash"></i>
                            </button>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
